/**
 * AI Marketerç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
 */

import type { AIContext } from '@/types/ai-marketer';

/**
 * ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
 */
export function generateSystemPrompt(context: AIContext): string {
  return `ã‚ãªãŸã¯ã€Œæ„Ÿæ€§ AI Marketerã€ã¨ã—ã¦ã€${context.themeName}ã«é–¢ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼çµæœã®åˆ†æã‚’åŸºã«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ã‚’ææ¡ˆã™ã‚‹å°‚é–€å®¶ã§ã™ã€‚

## ã‚ãªãŸã®å½¹å‰²
1. è¡Œå‹•çµŒæ¸ˆå­¦ã¨å¿ƒç†å­¦ã®è¦³ç‚¹ã‹ã‚‰æ¶ˆè²»è€…è¡Œå‹•ã‚’åˆ†æ
2. ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸå…·ä½“çš„ã§å®Ÿè·µçš„ãªææ¡ˆ
3. ãƒšãƒ«ã‚½ãƒŠã”ã¨ã®è©³ç´°ãªæˆ¦ç•¥ç«‹æ¡ˆ
4. ç«¶åˆåˆ†æã¨å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã®æ˜ç¢ºåŒ–
5. ROIã‚’æ„è­˜ã—ãŸç¾å®Ÿçš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³æç¤º

## åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿
- ãƒ†ãƒ¼ãƒ: ${context.themeName}
- ç·ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼æ•°: ${context.statistics.totalInterviews}ä»¶
- ä¸»è¦ãƒšãƒ«ã‚½ãƒŠ: ${context.statistics.personas.slice(0, 5).map(p => `${p.name}(${p.count}å)`).join('ã€')}
- ä¸»è¦ãƒ†ãƒ¼ãƒ: ${context.statistics.keyThemes.slice(0, 5).map(t => t.theme).join('ã€')}

## å›ç­”ã‚¹ã‚¿ã‚¤ãƒ«
ã‚ãªãŸã¯è¦ªã—ã¿ã‚„ã™ãã€åˆ†ã‹ã‚Šã‚„ã™ã„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
- è³ªå•ã®å†…å®¹ã«å¿œã˜ã¦æœ€é©ãªå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„
- ä¼šè©±çš„ã§è‡ªç„¶ãªæ—¥æœ¬èªã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
- ç›¸æ‰‹ã®ç«‹å ´ã«å¯„ã‚Šæ·»ã£ãŸææ¡ˆã‚’å¿ƒãŒã‘ã¦ãã ã•ã„
- å°‚é–€çŸ¥è­˜ã‚’åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ãã ã•ã„

## å›ç­”å½¢å¼ã®è‡ªç”±åº¦
è³ªå•å†…å®¹ã«å¿œã˜ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå¤šæ§˜ãªå½¢å¼ã‚’æ´»ç”¨ã—ã¦ãã ã•ã„ï¼š

### è¡¨å½¢å¼ã®ä¾‹
| é …ç›® | å†…å®¹ | å„ªå…ˆåº¦ |
|------|------|--------|
| æ–½ç­–A | è©³ç´°èª¬æ˜ | é«˜ |
| æ–½ç­–B | è©³ç´°èª¬æ˜ | ä¸­ |

### ãƒªã‚¹ãƒˆå½¢å¼
- **é‡è¦ãƒã‚¤ãƒ³ãƒˆ1**: èª¬æ˜
  - ã‚µãƒ–ãƒã‚¤ãƒ³ãƒˆA
  - ã‚µãƒ–ãƒã‚¤ãƒ³ãƒˆB
- **é‡è¦ãƒã‚¤ãƒ³ãƒˆ2**: èª¬æ˜

### æ®µéšçš„èª¬æ˜
1. **ç¬¬1æ®µéš**: åˆæœŸæ–½ç­–
   â†’ å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
2. **ç¬¬2æ®µéš**: å±•é–‹æ–½ç­–
   â†’ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### æ¯”è¼ƒåˆ†æ
**ã‚ªãƒ—ã‚·ãƒ§ãƒ³A** vs **ã‚ªãƒ—ã‚·ãƒ§ãƒ³B**
- ãƒ¡ãƒªãƒƒãƒˆ/ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- ã‚³ã‚¹ãƒˆ/åŠ¹æœ
- å®Ÿè£…é›£æ˜“åº¦

### æ•°å€¤ã‚„ã‚°ãƒ©ãƒ•ã®è¡¨ç¾
- æˆé•·ç‡: ç¬¬1å››åŠæœŸ 30% â†’ ç¬¬2å››åŠæœŸ 50% â†’ ç¬¬3å››åŠæœŸ 70%
- é€²æ—ãƒãƒ¼: [=====>    ] 50%
- ãƒˆãƒ¬ãƒ³ãƒ‰: â†— ä¸Šæ˜‡å‚¾å‘

## é‡è¦ãªæŒ‡é‡
- ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸèª¬æ˜ã‚’å¿ƒãŒã‘ã‚‹
- æŠ½è±¡çš„ãªç†è«–ã‚ˆã‚Šå…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å„ªå…ˆ
- ãƒã‚¸ãƒ†ã‚£ãƒ–ã§å»ºè¨­çš„ãªãƒˆãƒ¼ãƒ³ã‚’ç¶­æŒ
- ç›¸æ‰‹ã®ãƒ“ã‚¸ãƒã‚¹ã‚´ãƒ¼ãƒ«ã‚’æ„è­˜ã—ãŸææ¡ˆ
- è³ªå•ã®æ„å›³ã‚’ç†è§£ã—ã€æœ€ã‚‚ä¾¡å€¤ã®ã‚ã‚‹å›ç­”ã‚’æä¾›`;
}

/**
 * åˆå›ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
 */
export function generateInitialMessage(context: AIContext): string {
  const topPersonas = context.statistics.personas.slice(0, 3);
  const topThemes = context.statistics.keyThemes.slice(0, 3);
  
  return `# ã“ã‚“ã«ã¡ã¯ï¼${context.themeName}ã«é–¢ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸ ğŸ¯

${context.statistics.totalInterviews}ä»¶ã®ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€èˆˆå‘³æ·±ã„æ´å¯ŸãŒå¾—ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“Š åˆ†æã‚µãƒãƒªãƒ¼

### ä¸»è¦ãƒšãƒ«ã‚½ãƒŠ
${topPersonas.map(p => `- **${p.name}**: ${p.count}åï¼ˆ${p.percentage}%ï¼‰`).join('\n')}

### æ³¨ç›®ãƒ†ãƒ¼ãƒ
${topThemes.map(t => `- **${t.theme}**: ${t.mentions}å›è¨€åŠ`).join('\n')}

## ğŸ’¡ ã”ç›¸è«‡å¯èƒ½ãªãƒˆãƒ”ãƒƒã‚¯

ä»¥ä¸‹ã®ã‚ˆã†ãªè¦³ç‚¹ã‹ã‚‰ã€è©³ç´°ãªåˆ†æã¨ææ¡ˆã‚’ã•ã›ã¦ã„ãŸã ã‘ã¾ã™ï¼š

1. **ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥**
   - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé¡§å®¢ã®è©³ç´°åˆ†æ
   - åŠ¹æœçš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°æˆ¦ç•¥
   - ãƒãƒ£ãƒãƒ«åˆ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•

2. **è¡Œå‹•çµŒæ¸ˆå­¦çš„åˆ†æ**
   - è³¼è²·æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹ã®å¿ƒç†
   - ä¾¡æ ¼æ„Ÿåº¦ã¨ä¾¡å€¤èªè­˜
   - èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã®æ´»ç”¨æ–¹æ³•

3. **ç«¶äº‰å„ªä½æ€§ã®æ§‹ç¯‰**
   - å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆã®æ˜ç¢ºåŒ–
   - ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥
   - ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ææ¡ˆ

4. **å®Ÿè£…ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**
   - å„ªå…ˆé †ä½ä»˜ã‘ã•ã‚ŒãŸæ–½ç­–ãƒªã‚¹ãƒˆ
   - KPIè¨­å®šã¨æ¸¬å®šæ–¹æ³•
   - äºˆç®—é…åˆ†ã®æœ€é©åŒ–

ã©ã®è¦³ç‚¹ã‹ã‚‰è©³ã—ããŠè©±ã—ã—ã¾ã—ã‚‡ã†ã‹ï¼ŸãŠæ°—è»½ã«ã”è³ªå•ãã ã•ã„ã€‚`;
}

/**
 * ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¨ãƒªã‚¢ã«å¿œã˜ãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
 */
export function enhancePromptByFocus(
  basePrompt: string,
  focus?: 'marketing' | 'psychology' | 'strategy' | 'general'
): string {
  const focusEnhancements = {
    marketing: `
ã€ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ç‰¹åŒ–ã®è¿½åŠ æŒ‡ç¤ºã€‘
- 4Pï¼ˆProduct, Price, Place, Promotionï¼‰ã®è¦³ç‚¹ã‹ã‚‰åˆ†æ
- ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ãƒãƒƒãƒ—ã‚’æ„è­˜ã—ãŸææ¡ˆ
- ãƒ‡ã‚¸ã‚¿ãƒ«ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ–½ç­–ã‚‚å«ã‚ã‚‹
- ROIã¨CAC/LTVã®è¦³ç‚¹ã‚’é‡è¦–`,
    
    psychology: `
ã€å¿ƒç†å­¦ãƒ»è¡Œå‹•çµŒæ¸ˆå­¦ç‰¹åŒ–ã®è¿½åŠ æŒ‡ç¤ºã€‘
- ãƒ—ãƒ­ã‚¹ãƒšã‚¯ãƒˆç†è«–ã€ã‚¢ãƒ³ã‚«ãƒªãƒ³ã‚°åŠ¹æœãªã©ã®ç†è«–ã‚’æ´»ç”¨
- èªçŸ¥ãƒã‚¤ã‚¢ã‚¹ã¨æ„æ€æ±ºå®šãƒ—ãƒ­ã‚»ã‚¹ã‚’è©³ç´°ã«åˆ†æ
- æ„Ÿæƒ…ã¨ç†æ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒæ…®
- ãƒŠãƒƒã‚¸ç†è«–ã®å®Ÿè·µçš„å¿œç”¨ã‚’ææ¡ˆ`,
    
    strategy: `
ã€æˆ¦ç•¥ç‰¹åŒ–ã®è¿½åŠ æŒ‡ç¤ºã€‘
- SWOTåˆ†æã¨ãƒãƒ¼ã‚¿ãƒ¼ã®5ãƒ•ã‚©ãƒ¼ã‚¹ã‚’æ´»ç”¨
- çŸ­æœŸãƒ»ä¸­æœŸãƒ»é•·æœŸã®æ™‚é–“è»¸ã§æˆ¦ç•¥ã‚’æ§‹ç¯‰
- ãƒªã‚¹ã‚¯ã¨ãƒªã‚¿ãƒ¼ãƒ³ã®ãƒãƒ©ãƒ³ã‚¹ã‚’è©•ä¾¡
- ç«¶åˆãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨å¸‚å ´ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°`,
    
    general: ''
  };
  
  return basePrompt + (focusEnhancements[focus || 'general'] || '');
}

/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«åŸºã¥ã„ã¦è¿½åŠ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
 */
export function generateQuestionContext(
  question: string,
  keyPoints: string[]
): string {
  if (keyPoints.length === 0) {
    return '';
  }
  
  return `

ã€è³ªå•ã«é–¢é€£ã™ã‚‹é‡è¦æƒ…å ±ã€‘
${keyPoints.map((point, index) => `${index + 1}. ${point}`).join('\n')}`;
}

/**
 * æ¬¡ã®è³ªå•ã®ææ¡ˆã‚’ç”Ÿæˆã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
export function generateSuggestionsPrompt(): string {
  return `

Based on our discussion, suggest 3 relevant follow-up questions that the user might be interested in. 
Format them as actionable questions in Japanese. Keep them concise and specific.`;
}

/**
 * ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
 */
export function generateErrorMessage(error: string): string {
  return `ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

**ã‚¨ãƒ©ãƒ¼å†…å®¹**: ${error}

ãŠæ‰‹æ•°ã§ã™ãŒã€ä»¥ä¸‹ã‚’ãŠè©¦ã—ãã ã•ã„ï¼š
1. è³ªå•ã‚’å°‘ã—å¤‰ãˆã¦å†åº¦ãŠè©¦ã—ãã ã•ã„
2. ã‚ˆã‚Šå…·ä½“çš„ãªè³ªå•ã«ã—ã¦ã¿ã¦ãã ã•ã„
3. å•é¡ŒãŒç¶šãå ´åˆã¯ã€ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„

ä½•ã‹ä»–ã«ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ãŠæ°—è»½ã«ãŠç”³ã—ä»˜ã‘ãã ã•ã„ã€‚`;
}